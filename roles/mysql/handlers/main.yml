- name: Restart mysql
  listen: "restart mysql"
  become: true
  ansible.builtin.systemd:
    name: "{{ systemd_mysql_service }}"
    enabled: true
    daemon_reload: true
    state: restarted
  notify: mysql service is running

- name: Make sure mysql service is running
  listen: "mysql service is running"
  ansible.builtin.service_facts: {}
  register: __service_status
  until: "__service_status.ansible_facts.services[systemd_mysql_service].state == 'running'"
  retries: 5
  delay: 5

- name: Delete clone user on the primary host
  listen: "delete clone user"
  become: true
  mysql_user:
    name: "{{ _clone_user }}"
    host: "{{ _replica_ip }}"
    login_unix_socket: "{{ _primary_unix_socket }}"
    login_user: "root"
    state: absent
  delegate_to: "{{ _primary_host }}"

---
 - name: Include OS Tasks
   include_tasks: "{{ ansible_os_family }}.yml"

 - name: Add nginx group
   group:
     name: "{{ group }}"
     state: present
     system: yes

 - name: Add nginx user
   user:
     name: "{{ user }}"
     group: "{{ group }}"
     createhome: no
     shell: /sbin/nologin
     state: present
     system: yes

 - name: Setup nginx.conf
   template:
     src: "nginx.conf.j2"
     dest: "{{ config_path }}/nginx.conf"

 - name: Sync nginx conf.d and ssl.d
   synchronize:
     src: "{{ item }}"
     dest: "{{ config_path }}"
   loop:
     - "conf.d"
     - "ssl.d"

 - name: Create nginx vhosts directory
   file:
     path: "{{ config_path }}/vhosts"
     state: directory

 - name: Create Logs Dir
   file:
     path: "{{ log_path }}" 
     owner: "{{ user }}"
     group: "{{ group }}"
     state: directory

 - name: Set Regular Clean Nginx Logs
   template: 
     src: nginx.logrotate.j2
     dest: /etc/logrotate.d/nginx

 - name: Enable Nginx
   systemd:
     name: nginx
     state: restarted
     enabled: yes
     daemon_reload: yes
...

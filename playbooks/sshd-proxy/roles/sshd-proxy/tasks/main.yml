---
- name: Include os tasks
  include_tasks: "{{ ansible_os_family }}.yml"

- name: Setup proxy info
  blockinfile:
    marker: "# {mark} ANSIBLE MANAGED BLOCK FOR SSHD-{{ proxy_port }}"
    dest: "/etc/haproxy/haproxy.cfg"
    block: |
      listen sshd-{{ proxy_port }}
          bind 0.0.0.0:{{ proxy_port }}
          mode tcp
          maxconn 2000
          balance roundrobin
          server sshd {{ sshd_hostname }}:{{ sshd_port }}
  notify: reload haproxy
